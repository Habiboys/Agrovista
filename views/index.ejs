<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link href="/css/tailwind.css" rel="stylesheet" />
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>

  <body class="font-sans">
    <!-- Navigation -->
    <nav class="bg-white p-4 flex justify-between items-center">
      <div class="text-green-700 font-bold text-xl">
        Desa Wisata Leuwi Malang
      </div>
      <div class="space-x-4">
        <a href="#" class="text-green-700">Home</a>
        <a href="#" class="text-green-700">Kegiatan</a>
        <a href="#" class="text-green-700">Paket</a>
        <a href="#" class="text-green-700">Kontak</a>
      </div>
      <a href="/ulasan" class="bg-green-700 text-white px-4 py-2 rounded"
        >Beri Ulasan</a
      >
    </nav>
    <div id="chat-icon" class="fixed bottom-5 right-5 bg-blue-500 text-white rounded-full p-3 cursor-pointer shadow-lg z-40">
      <i data-lucide="message-circle" class="w-6 h-6"></i>
  </div>

  <div id="chat-window" class="hidden fixed bottom-20 right-5 w-80 bg-white rounded-lg shadow-xl z-50">
      <div class="bg-blue-500 text-white p-4 rounded-t-lg">
          <h3 class="font-bold">Tanya Mr Noid</h3>
      </div>
      <div id="chat-messages" class="h-80 overflow-y-auto p-4">
          <!-- Chat messages will be appended here -->
      </div>
      <div class="p-4 border-t">
          <input id="user-input" type="text" placeholder="Type your message..." class="w-full p-2 border rounded">
          <button id="send-btn" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded">Send</button>
      </div>
  </div>


    <!-- Hero Section -->
    <div
      class="relative h-[500px] bg-cover bg-center"
      style="
        background-image: url('https://images.unsplash.com/photo-1655761940444-b666fd26f685?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
      "
    >
      <div
        class="absolute inset-0 bg-black bg-opacity-50 flex flex-col justify-center items-start p-12"
      >
        <h1 class="text-white text-5xl font-bold mb-4">
          Desa Wisata Leuwi Malang
        </h1>
        <p class="text-white text-xl mb-8 max-w-2xl">
          There are many variations of passages of Lorem Ipsum available, but
          the majority have suffered alteration in some form, by injected
          humour, or randomised words which don't look even slightly believable.
        </p>
        <div class="space-x-4">
          <a
            class="bg-green-600 text-white px-6 py-3 rounded-full"
            href="/ulasan"
          >
            Beri Ulasan
          </a>
          <button class="bg-white text-green-700 px-6 py-3 rounded-full">
            Selengkapnya
          </button>
        </div>
      </div>
    </div>

    <!-- Statistics -->
    <div class="bg-green-600 text-white py-8">
      <div class="container mx-auto flex justify-around">
        <div class="text-center">
          <div class="text-4xl font-bold">350+</div>
          <div>Pengunjung</div>
        </div>
        <div class="text-center">
          <div class="text-4xl font-bold"><%= total_ulasan %></div>
          <div>Ulasan</div>
        </div>
        <div class="text-center">
          <div class="text-4xl font-bold"><%= total_wisata %></div>
          <div>Jenis Wisata</div>
        </div>
        <div class="text-center">
          <div class="text-4xl font-bold">5</div>
          <div>Paket Wisata</div>
        </div>
      </div>
    </div>

    <!-- About Us -->
    <div class="container mx-auto py-16 flex items-center">
      <div class="w-1/2 pr-8">
        <img
          src="https://images.unsplash.com/photo-1620799180805-b4e4c568a245?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
          alt="About Us"
          class="rounded-lg shadow-lg"
        />
      </div>
      <div class="w-1/2">
        <h2 class="text-3xl font-bold text-green-700 mb-4">Tentang Kami</h2>
        <p class="text-gray-600 mb-4">
          There are many variations of passages of Lorem Ipsum available, but
          the majority have suffered alteration in some form, by injected
          humour, or randomised words which don't look even slightly believable.
          Praesent pretium sed augue vel egestas.
        </p>
        <p class="text-gray-600">
          Class aptent taciti sociosqu ad litora torquent per conubia nostra,
          per inceptos himenaeos.
        </p>
      </div>
    </div>

    <!-- Agrotourism -->
    <div class="bg-gray-100 py-16">
      <div class="container mx-auto">
        <h2 class="text-3xl font-bold text-green-700 mb-8 text-center">
          Agroturism
        </h2>
        <div class="flex justify-between">
          <% jenisWisata.forEach((jeniswisata) => { %>
          <div class="w-1/3 px-4">
            <img src="<%= jeniswisata.gambar %>" alt="Agrotourism" class="h-24
            w-full object-cover rounded-lg shadow-md mb-4 />
            <h3 class="text-xl font-semibold mb-2">
              <%= jeniswisata.nama_wisata %>
            </h3>
            <p class="text-gray-600"><%= jeniswisata.deskripsi %></p>
          </div>
          <% }) %>
        </div>
      </div>
    </div>

    <!-- Latest Reviews -->
    <div class="container mx-auto py-16">
      <h2 class="text-3xl font-bold text-green-700 mb-8 text-center">
        Ulasan Terbaru
      </h2>
      <div class="flex justify-between gap-6">
        <% dataUlasan.forEach((dataulasan) => { %>
        <div class="w-1/3 px-4 bg-white rounded-lg shadow-md p-6">
          <div class="flex items-center mb-4">
            <img
              src="https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?q=80&w=1780&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
              alt="Reviewer 1"
              class="w-12 h-12 rounded-full mr-4"
            />
            <div>
              <h3 class="font-semibold"><%= dataulasan.nama %></h3>
              <p class="text-gray-500 text-sm"><%= dataulasan.pekerjaan %></p>
            </div>
          </div>
          <p class="text-gray-600"><%= dataulasan.ulasan %></p>
        </div>
        <% }) %>
      </div>
    </div>

    <!-- Gallery -->
    <div class="bg-gray-100 py-16">
      <div class="container mx-auto">
        <h2 class="text-3xl font-bold text-green-700 mb-8 text-center">
          Galeri
        </h2>
        <div class="grid grid-cols-3 gap-4">
          <img
            src="https://images.unsplash.com/photo-1677618164836-1af1646e4ab0?q=80&w=2034&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="Gallery 1"
            class="rounded-lg shadow-md"
          />
          <img
            src="https://images.unsplash.com/photo-1541270691237-da75a9617329?q=80&w=1776&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="Gallery 2"
            class="rounded-lg shadow-md"
          />
          <img
            src="https://images.unsplash.com/photo-1503521645102-f0c28f44ac17?q=80&w=1932&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="Gallery 3"
            class="rounded-lg shadow-md"
          />
          <img
            src="https://images.unsplash.com/photo-1473448912268-2022ce9509d8?q=80&w=2041&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="Gallery 4"
            class="rounded-lg shadow-md"
          />
          <img
            src="https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?q=80&w=2074&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="Gallery 5"
            class="rounded-lg shadow-md"
          />
          <img
            src="https://images.unsplash.com/reserve/wPCyys8TPCHY3GXm2N2D_ssp_inthewoods_1.jpg?q=80&w=1920&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D"
            alt="Gallery 6"
            class="rounded-lg shadow-md"
          />
        </div>
      </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-green-700 text-white py-12">
      <div class="container mx-auto flex justify-between">
        <div class="w-1/4">
          <h3 class="text-xl font-bold mb-4">Desa Wisata Leuwi Malang</h3>
          <p>
            There are many variations of passages of Lorem Ipsum available, but
            the majority suffered alteration in some form.
          </p>
        </div>
        <div class="w-1/4">
          <h3 class="text-xl font-bold mb-4">Quick Links</h3>
          <ul>
            <li><a href="#" class="hover:underline">Home</a></li>
            <li><a href="#" class="hover:underline">Kegiatan</a></li>
            <li><a href="#" class="hover:underline">Paket</a></li>
            <li><a href="#" class="hover:underline">Kontak</a></li>
          </ul>
        </div>
        <div class="w-1/4">
          <h3 class="text-xl font-bold mb-4">Contacts</h3>
          <p>+62xxxxxxxxxx</p>
          <p>info@desawisata.com</p>
        </div>
        <div class="w-1/4">
          <h3 class="text-xl font-bold mb-4">Location</h3>
          <p>
            Jl. Raya Desa Wisata No. 123, Kecamatan Indah, Kabupaten Sejahtera,
            Provinsi Bahagia
          </p>
        </div>
      </div>
      <div class="text-center mt-8">
        <p>&copy; 2024 All Rights Reserved</p>
      </div>
    </footer>
    



    <div class="p-4 flex justify-center items-center h-screen bg-gray-100">
      <!-- Button to Open Scanner -->
      <button id="openScannerButton" class="bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-indigo-600 hover:to-blue-500 text-white font-semibold py-3 px-6 rounded-lg shadow-lg transition-all transform hover:scale-105">
        Buka Scanner Barcode
      </button>
    
      <!-- Modal -->
      <div id="scannerModal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden">
        <div class="relative w-full max-w-lg bg-white rounded-lg shadow-xl transform transition-all p-8">
          <div class="text-center">
            <h3 class="text-2xl font-bold text-gray-800 mb-4">Scanner Barcode</h3>
    
            <!-- Scanner Container -->
            <div id="scanner-container" class="relative w-72 h-72 mx-auto bg-gray-100 rounded-lg shadow-md overflow-hidden">
              <video id="video" class="absolute inset-0 w-full h-full object-cover rounded-lg"></video>
              <div id="scanner-overlay" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                <div class="w-48 h-48 border-2 border-blue-500 rounded-lg"></div>
              </div>
    
              <!-- Corner markers with margins -->
              <div class="absolute top-3 left-3 w-6 h-6 border-t-2 border-l-2 border-blue-500"></div>
              <div class="absolute top-3 right-3 w-6 h-6 border-t-2 border-r-2 border-blue-500"></div>
              <div class="absolute bottom-3 left-3 w-6 h-6 border-b-2 border-l-2 border-blue-500"></div>
              <div class="absolute bottom-3 right-3 w-6 h-6 border-b-2 border-r-2 border-blue-500"></div>
            </div>
    
            <div id="result" class="mt-4 text-lg font-medium text-gray-600"></div>
    
            <!-- Close Button -->
            <button id="closeScannerButton" class="mt-6 py-2 px-4 bg-red-500 text-white font-semibold rounded-md shadow-lg hover:bg-red-600 transition-all">
              Tutup Scanner
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
  <script>
   const openScannerButton = document.getElementById('openScannerButton');
  const closeScannerButton = document.getElementById('closeScannerButton');
  const scannerModal = document.getElementById('scannerModal');
  const resultDiv = document.getElementById('result');
  const videoElement = document.getElementById('video');
  let scanning = false;
  let codeReader;

  openScannerButton.addEventListener('click', openModal);
  closeScannerButton.addEventListener('click', closeModal);

  function openModal() {
    // Reset hasil scan setiap kali scanner dibuka
    resultDiv.textContent = '';
    scannerModal.classList.remove('hidden');

    // Mulai scanning ulang
    startScanning();
  }

  function closeModal() {
    scannerModal.classList.add('hidden');
    stopScanning();
  }

  function startScanning() {
    scanning = true;
    resultDiv.textContent = 'Memulai scanner...';
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(function (stream) {
        videoElement.srcObject = stream;
        videoElement.play();

        // Jika belum ada instance codeReader, buat baru
        if (!codeReader) {
          codeReader = new ZXing.BrowserMultiFormatReader();
        }

        // Mulai membaca barcode dari video
        codeReader.decodeFromVideoDevice(null, videoElement, (result, err) => {
          if (result) {
            const scannedResult = result.text;
            resultDiv.textContent = `Kode yang terdeteksi: ${scannedResult}`;

            // Jika hasilnya valid URL, buka di tab baru
            if (isValidURL(scannedResult)) {
              window.open(scannedResult, '_blank');
            } else {
              resultDiv.textContent = `Hasil tidak valid sebagai URL: ${scannedResult}`;
            }
            stopScanning(); // Hentikan scanning setelah mendapatkan hasil
          }

          if (err && !(err instanceof ZXing.NotFoundException)) {
            console.error("Error:", err);
          }
        });
      })
      .catch(function (err) {
        console.error("Error accessing the camera", err);
        resultDiv.textContent = 'Error: Tidak dapat mengakses kamera. ' + err.message;
      });
  }

  function stopScanning() {
    if (scanning) {
      scanning = false;

      // Hentikan semua track video
      const stream = videoElement.srcObject;
      const tracks = stream ? stream.getTracks() : [];

      tracks.forEach(track => track.stop());
      videoElement.srcObject = null;

      // Hentikan pembacaan kode dan reset
      if (codeReader) {
        codeReader.reset();
      }
    }
  }

  function isValidURL(string) {
    try {
      new URL(string);
      return true;
    } catch (_) {
      return false;
    }
  }
    //CHAT ====================
      lucide.createIcons();

      const chatIcon = document.getElementById('chat-icon');
      const chatWindow = document.getElementById('chat-window');
      const chatMessages = document.getElementById('chat-messages');
      const userInput = document.getElementById('user-input');
      const sendBtn = document.getElementById('send-btn');

      chatIcon.addEventListener('click', () => {
          chatWindow.classList.toggle('hidden');
      });

      sendBtn.addEventListener('click', sendMessage);
      userInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') sendMessage();
      });

      function sendMessage() {
          const message = userInput.value.trim();
          if (message) {
              appendMessage('user', message);
              fetchResponse(message);
              userInput.value = '';
          }
      }

      function appendMessage(sender, content) {
          const messageDiv = document.createElement('div');
          messageDiv.className = `mb-2 ${sender === 'user' ? 'text-right' : 'text-left'}`;
          messageDiv.innerHTML = `
              <div class="inline-block p-2 rounded-lg ${sender === 'user' ? 'bg-blue-100' : 'bg-gray-200'}">
                  ${content}
              </div>
          `;
          chatMessages.appendChild(messageDiv);
          chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      async function fetchResponse(message) {
          try {
              const response = await fetch('/chat', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({ question: message }),
              });
              const data = await response.json();
              appendMessage('bot', data.response);
          } catch (error) {
              console.error('Error:', error);
              appendMessage('bot', 'Sorry, there was an error processing your request.');
          }
      }
  </script>
  </body>
</html>
